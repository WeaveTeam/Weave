<?xml version="1.0" encoding="utf-8"?>
<!--
/*
    Weave (Web-based Analysis and Visualization Environment)
    Copyright (C) 2008-2011 University of Massachusetts Lowell

    This file is a part of Weave.

    Weave is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License, Version 3,
    as published by the Free Software Foundation.

    Weave is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Weave.  If not, see <http://www.gnu.org/licenses/>.
*/
-->
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml"
		 xmlns="weave.editors.*"
		 xmlns:ui="weave.ui.*"
		 label=""
		 enabled="{_panel != null}"
		 verticalGap="{verticalGap}"
		 creationPolicy="all" >
	
	<mx:HBox width="100%">
		<mx:CheckBox id="enableTitle" label="Visualization title" toolTip="Selecting this option will turn the title of this tool on or off"
					 creationComplete="linkBindableProperty(_enableTitle, event.target, 'selected');"/>
		<mx:TextInput id="titleInput"
					  width="100%"
					  toolTip="Entering a title here will override the automatic title generated by the tool."
					  creationComplete="linkBindableProperty(_panel.panelTitle, event.target, 'text', 500);"/>
	</mx:HBox>
	<mx:HBox verticalAlign="middle">
		<mx:Label text="Background color:"/>
		<mx:ColorPicker toolTip="Select a color for the background of this visualization tool." 
						id="backgroundColorPicker"
						change="backgroundColorPicked();"/>
		<mx:Button label="Reset" click="_panel.panelBackgroundColor.value = NaN;"/>
		<mx:HBox width="100%" id="marginProperties" verticalAlign="middle">
			<mx:Label  text="Margins:"/>
			
			<mx:TextInput id="marginLeft" toolTip="Enter a number of pixels or a percentage to use for the left margin" width="50"
							   creationComplete="linkBindableProperty(_visualization.marginLeft, event.target, 'text', 500);"/>
			<mx:VBox>
				<mx:TextInput id="marginTop" toolTip="Enter a number of pixels or a percentage to use for the top margin" width="50"
							  creationComplete="linkBindableProperty(_visualization.marginTop, event.target, 'text', 500);"/>
				<mx:TextInput id="marginBottom" toolTip="Enter a number of pixels or a percentage to use for the bottom margin" width="50"
							  creationComplete="linkBindableProperty(_visualization.marginBottom, event.target, 'text', 500);"/>
			</mx:VBox>
			<mx:TextInput id="marginRight" toolTip="Enter a number of pixels or a percentage to use for the right margin" width="50"
						  creationComplete="linkBindableProperty(_visualization.marginRight, event.target, 'text', 500);"/>
		</mx:HBox>
	</mx:HBox>
	<mx:VBox id="axisSettings" verticalGap="{verticalGap}" verticalAlign="middle">
		<mx:HBox verticalAlign="middle">
			<ui:Indent label="Axis color:">
				<mx:ColorPicker id="axisColorPicker" toolTip="Select a color for the axis border of this visualization"
								creationComplete="linkBindableProperty(_visualization.axesColor, event.target, 'selectedColor');"/>
			</ui:Indent>
			<ui:Indent label="Axis thickness:">
				<mx:NumericStepper id="axisThicknessStepper" minimum="0" maximum="50"
								   creationComplete="linkBindableProperty(_visualization.axesThickness, event.target, 'value');"/>
			</ui:Indent>
			<ui:Indent label="Axis alpha:">
				<mx:NumericStepper id="axisAlphaStepper" minimum="0" maximum="1" stepSize="0.1" toolTip="0 = transparent; 1 = opaque"
							creationComplete="linkBindableProperty(_visualization.axesAlpha, event.target, 'value');"/>
			</ui:Indent>
		</mx:HBox>
		<mx:HBox verticalAlign="middle">
			<ui:Indent label="Grid color:">
				<mx:ColorPicker id="gridColorPicker" toolTip="Select a color for the grid lines of this visualization"
								creationComplete="linkBindableProperty(_visualization.gridLineColor, event.target, 'selectedColor');"/>
			</ui:Indent>
			<ui:Indent label="Grid thickness:">
				<mx:NumericStepper id="gridLineThicknessStepper" minimum="1" maximum="10"
								   creationComplete="linkBindableProperty(_visualization.gridLineThickness, event.target, 'value');"/>
			</ui:Indent>
			<ui:Indent label="Grid alpha:">
				<mx:NumericStepper id="gridLineAlphaStepper" minimum="0" maximum="1" stepSize="0.1" toolTip="0 = transparent; 1 = opaque"
							creationComplete="linkBindableProperty(_visualization.gridLineAlpha, event.target, 'value');"/>
			</ui:Indent>
		</mx:HBox>
		<mx:HBox verticalAlign="middle">
			<mx:VBox>
				<ui:TextBox indent="128" label="Y axis title:" id="yAxisTitle"/>
				<ui:TextBox indent="128" label="Y axis label function:" id="yAxisLabelFunction"/>
			</mx:VBox>
			<mx:VBox>
				<ui:Indent indent="64" label="Distance:">
					<mx:NumericStepper id="yLabelDistance" minimum="-50" maximum="50" stepSize="5" width="64"/>
				</ui:Indent>
				<ui:Indent indent="64" label="Angle:">
					<mx:NumericStepper id="yLabelAngle" minimum="-180" maximum="180" stepSize="15" width="64"/>
				</ui:Indent>
			</mx:VBox>
			<ui:AlignmentControl id="yLabelAlign"/>
		</mx:HBox>
		<mx:HBox verticalAlign="middle">
			<mx:VBox>
				<ui:TextBox indent="128" label="X axis title:" id="xAxisTitle"/>
				<ui:TextBox indent="128" label="X axis label function:" id="xAxisLabelFunction"/>
			</mx:VBox>
			<mx:VBox>
				<ui:Indent indent="64" label="Distance:">
					<mx:NumericStepper id="xLabelDistance" minimum="-50" maximum="50" stepSize="5" width="64"/>
				</ui:Indent>
				<ui:Indent indent="64" label="Angle:">
					<mx:NumericStepper id="xLabelAngle" minimum="-180" maximum="180" stepSize="15" width="64"/>
				</ui:Indent>
			</mx:VBox>
			<ui:AlignmentControl id="xLabelAlign"/>
		</mx:HBox>
	</mx:VBox>

	<mx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			
			import weave.api.linkBindableProperty;
			import weave.core.LinkableBoolean;
			import weave.ui.DraggablePanel;
			import weave.visualization.layers.SimpleInteractiveVisualization;
			
			private const verticalGap:int = 16;
			private const indent:int = 150;

			[Bindable]
			private var _panel:DraggablePanel = null;
			private var _visualization:SimpleInteractiveVisualization = null;
			private var _enableTitle:LinkableBoolean = null;
			
			/**
			 * This function takes three parameters instead of one SimpleVisTool in order to
			 * avoid a chicken-and-egg problem between SimpleAxisEditor and SimpleVisTool.
			 */
			public function setTargets(panel:DraggablePanel, visualization:SimpleInteractiveVisualization, enableTitle:LinkableBoolean):void
			{
				if (_panel)
					throw new Error("targets should not be set more than once");
				
				_panel = panel;
				_visualization = visualization;
				_enableTitle = enableTitle;
			}
			override protected function childrenCreated():void
			{
				super.childrenCreated();
				
				_panel.panelBackgroundColor.addGroupedCallback(this, backgroundColorCallback, true);
				_panel.addEventListener(FlexEvent.UPDATE_COMPLETE, function(..._):void { backgroundColorCallback(); });
				
				if (_visualization.getXAxisLayer())
				{
					linkBindableProperty(_visualization.getXAxisLayer().axisPlotter.overrideAxisName, xAxisTitle, 'text');
					linkBindableProperty(_visualization.getXAxisLayer().axisPlotter.labelFunction, xAxisLabelFunction, 'text');
					linkBindableProperty(_visualization.getXAxisLayer().axisPlotter.axisLabelRelativeAngle, xLabelAngle, 'value');
					linkBindableProperty(_visualization.getXAxisLayer().axisPlotter.labelHorizontalAlign, xLabelAlign, 'horizontalAlign');
					linkBindableProperty(_visualization.getXAxisLayer().axisPlotter.labelVerticalAlign, xLabelAlign, 'verticalAlign');
					linkBindableProperty(_visualization.getXAxisLayer().axisPlotter.axisLabelDistance, xLabelDistance, 'value');
					
					linkBindableProperty(_visualization.getYAxisLayer().axisPlotter.overrideAxisName, yAxisTitle, 'text');
					linkBindableProperty(_visualization.getYAxisLayer().axisPlotter.labelFunction, yAxisLabelFunction, 'text');
					linkBindableProperty(_visualization.getYAxisLayer().axisPlotter.axisLabelRelativeAngle, yLabelAngle, 'value');
					linkBindableProperty(_visualization.getYAxisLayer().axisPlotter.labelHorizontalAlign, yLabelAlign, 'horizontalAlign');
					linkBindableProperty(_visualization.getYAxisLayer().axisPlotter.labelVerticalAlign, yLabelAlign, 'verticalAlign');
					linkBindableProperty(_visualization.getYAxisLayer().axisPlotter.axisLabelDistance, yLabelDistance, 'value');
					
					if (!label)
						label = "Axes";
				}
				else
				{
					axisSettings.parent.removeChild(axisSettings);
					if (!label)
						label = "Background";
				}
			}
			
			private function backgroundColorCallback():void
			{
				backgroundColorPicker.selectedColor = _panel.getStyle('backgroundColor');
			}
			private function backgroundColorPicked():void
			{
				_panel.panelBackgroundColor.value = backgroundColorPicker.selectedColor;
			}
			private function alphaSliderFormatFunction(value:Number):String
			{
				return int((value * 100)) + "% Opaque" + "\n" + int(100 - (value * 100)) + "% Transparent";
			}
		]]>
	</mx:Script>
</mx:VBox>
